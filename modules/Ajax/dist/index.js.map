{"version":3,"sources":["../src/index.js"],"names":["sword","type","success","error","data","url","sync","Promise","resolve","reject","ajax","toLowerCase","content","xrh","HTTPError","readyState","status","name","outTime","__JSONP","err","JSON","stringify","JSONP","message","Error","dataString","txt","Math","random","i","value","escape","toString","get","s","e","xhr","XMLHttpRequest","open","onreadystatechange","responseText","send","post","setRequestHeader","head","document","getElementsByTagName","script","createElement","__JSONP_CALLBACK","src","appendChild","window","removeChild","clearTimeout","timer","loadError","loader","state","setTimeout","onerror","define","exports"],"mappings":"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","file":"index.js","sourcesContent":["\"use strict\";\n\n!function (sword) {\n    // 定义HTTPError类用于抛出HTTPERROR\n    class HTTPError extends Error {\n        constructor(message) {\n            super();\n            this.name = \"HTTPError: \";\n            this.message = message;\n        }\n    }\n\n    function dataString(data) {\n        let txt = \"__token=\" + Math.random();// 默认首先添加一个令牌防止浏览器缓存\n        for (let i in data) {\n            txt += \"&\" + i + \"=\";\n            let value = data[i];\n            switch (typeof value) {\n                case \"string\":\n                    txt += escape(value);\n                    break;\n                case \"object\":\n                    txt += escape(JSON.stringify(value));\n                    break;\n                case \"function\":\n                    txt += escape(value.toString());\n                    break;\n                case \"undefined\":\n                    txt += escape(\"undefined\");\n                    break;\n                default:\n                    txt += escape(value.toString());\n                    break;\n            }\n        }\n        return txt;\n    }\n\n    // ajax\n    function get(url, data, s, e) {\n        let xhr = new XMLHttpRequest();\n        xhr.open(\"GET\", `${url}${(() => {\n            let txt = dataString(data);\n            if (txt != \"\") return \"?\" + txt;\n            return \"\";\n        })()}`, true);\n        xhr.onreadystatechange = function() {\n            if (xhr.readyState == 4 && xhr.status == 200 || xhr.status == 304) {// 请求完成\n                if (s) s(xhr.responseText);\n            } else if (xhr.readyState == 4) {\n                if (e) e(xhr);\n            }\n        };\n        xhr.send();\n    }\n    function post(url, data, s, e) {\n        let xhr = new XMLHttpRequest();\n        xhr.open(\"POST\", url, true);\n        xhr.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");\n        xhr.onreadystatechange = function() {\n            if (xhr.readyState == 4 &&  xhr.status == 200 || xhr.status == 304) {// 请求完成\n                if (s) s(xhr.responseText);\n            } else if (xhr.readyState == 4) {\n                if (e) e(xhr);\n            }\n        };\n        xhr.send(dataString(data));\n    }\n    async function ajax({ type = \"get\", success, error, data, url, sync = false }) {\n        if (sync) {\n            return (await new Promise((resolve, reject) => {\n                ajax[type.toLowerCase()](url, data, (content) => {\n                    resolve(content);\n                }, (xrh) => {\n                    reject(new HTTPError(`HTTP request failed.\\nRequest-Type: ${type}; Request-URL: ${url}; state: ${xrh.readyState}; status: ${xrh.status}`));\n                });\n            }));\n        } else {\n            ajax[type.toLowerCase()](url, data, success, error);\n        }\n    }\n    ajax.get = get;\n    ajax.post = post;\n\n    // JSONP\n    function __JSONP({ url, data, success, error, name = \"JSONP_CALLBACK\", outTime = 10000 }) {\n        let head = document.getElementsByTagName(\"head\")[0];\n        let script = document.createElement(\"script\");\n        data.__JSONP_CALLBACK = name;\n        script.src = url + \"?\" + dataString(data);\n        head.appendChild(script);\n\n        window[name] = function (content) {\n            head.removeChild(script);\n            clearTimeout(script.timer);\n            delete window[name];\n            if (success) success(content);\n        };\n\n        function loadError() {\n            head.removeChild(script);\n            if (error) error({ loader: script, state: 0, message: \"Timeout\", outTime });\n        }\n        // 超时处理\n        script.timer = setTimeout(loadError, outTime);\n        // 加载错误处理\n        script.onerror = loadError;\n    }\n\n    async function JSONP({url, data, success, error, name = \"JSONP_CALLBACK\", sync = false, outTime = 10000}) {\n        if (sync) {\n            return (await new Promise((resolve, reject) => {\n                __JSONP({\n                    url, data, success: (content) => {\n                        resolve(content);\n                    }, error: (err) => {\n                        reject(new HTTPError(`HTTP request failed.\\nRequest-Type: JSONP;\\nError-Message: ${JSON.stringify(err, null, 4)}`));\n                    }, name, outTime\n                });\n            }));\n        } else {\n            __JSONP({\n                url, data, success, error, name, outTime\n            });\n        }\n    }\n    sword.define(\"Ajax\", (exports) => {\n        exports({\n            get, post, ajax,\n            JSONP\n        });\n    });\n}(sword);"]}